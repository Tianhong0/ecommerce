import{_ as x,d as U,r as M,y as b,o as I,w as N,f as h,g as t,h as u,v as S,b as i,e as c,i as _,m as F,z,M as j,j as k,E as m,O as L}from"./index.2cc8de7c.js";import{u as O}from"./upload.a442cc91.js";import"./request.12a390b5.js";const T={class:"profile-container"},W={class:"avatar-container"},q=["src"],G=U({__name:"index",setup(H){const l=S(),s=M(!1),e=b({id:0,username:"",nickname:"",email:"",phone:"",avatar:""}),o=b({nickname:"",email:"",phone:"",avatar:""});I(()=>{l.dispatch("user/getCurrentUserInfo").then(()=>{E()})}),N(()=>l.state.user,()=>{E()},{deep:!0});const E=()=>{e.id=l.state.user.id||0,e.username=l.state.user.name||"",e.nickname=l.state.user.nickname||"",e.email=l.state.user.email||"",e.phone=l.state.user.phone||"",e.avatar=l.state.user.avatar||""},y=()=>{o.nickname=e.nickname,o.email=e.email,o.phone=e.phone,o.avatar=e.avatar,s.value=!0},B=()=>{e.nickname=o.nickname,e.email=o.email,e.phone=o.phone,e.avatar=o.avatar,s.value=!1},V=n=>{const a=n.type.startsWith("image/"),f=n.size/1024/1024<2;return a?f?!0:(m.error("\u5934\u50CF\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 2MB!"),!1):(m.error("\u5934\u50CF\u5FC5\u987B\u662F\u56FE\u7247\u683C\u5F0F!"),!1)},g=async n=>{if(!!n.raw)try{const a=await O(n.raw);a&&a.success&&(e.avatar=a.data,m.success("\u5934\u50CF\u4E0A\u4F20\u6210\u529F"),s.value||await C())}catch(a){m.error(a.message||"\u5934\u50CF\u4E0A\u4F20\u5931\u8D25")}},C=async()=>{try{console.log("\u63D0\u4EA4\u7684\u6570\u636E:",{nickname:e.nickname,email:e.email,phone:e.phone,avatar:e.avatar});const n=await L({nickname:e.nickname,email:e.email,phone:e.phone,avatar:e.avatar});await l.dispatch("user/getCurrentUserInfo"),m.success("\u4E2A\u4EBA\u4FE1\u606F\u66F4\u65B0\u6210\u529F"),s.value=!1}catch(n){m.error(n.message||"\u66F4\u65B0\u5931\u8D25")}};return(n,a)=>{const f=i("el-icon"),D=i("el-upload"),p=i("el-input"),d=i("el-form-item"),v=i("el-button"),A=i("el-form"),w=i("el-card");return c(),h("div",T,[t(w,{class:"profile-card"},{header:u(()=>a[4]||(a[4]=[_("div",{class:"card-header"},[_("span",null,"\u4E2A\u4EBA\u4FE1\u606F")],-1)])),default:u(()=>[_("div",W,[t(D,{class:"avatar-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":g,"before-upload":V},{default:u(()=>[e.avatar?(c(),h("img",{key:0,src:e.avatar,class:"avatar"},null,8,q)):(c(),F(f,{key:1,class:"avatar-uploader-icon"},{default:u(()=>[t(z(j))]),_:1}))]),_:1}),a[5]||(a[5]=_("div",{class:"avatar-text"},"\u70B9\u51FB\u4E0A\u4F20\u5934\u50CF",-1))]),t(A,{model:e,"label-width":"100px",class:"profile-form"},{default:u(()=>[t(d,{label:"\u7528\u6237\u540D"},{default:u(()=>[t(p,{modelValue:e.username,"onUpdate:modelValue":a[0]||(a[0]=r=>e.username=r),disabled:""},null,8,["modelValue"])]),_:1}),t(d,{label:"\u6635\u79F0"},{default:u(()=>[t(p,{modelValue:e.nickname,"onUpdate:modelValue":a[1]||(a[1]=r=>e.nickname=r),disabled:!s.value},null,8,["modelValue","disabled"])]),_:1}),t(d,{label:"\u90AE\u7BB1"},{default:u(()=>[t(p,{modelValue:e.email,"onUpdate:modelValue":a[2]||(a[2]=r=>e.email=r),disabled:!s.value},null,8,["modelValue","disabled"])]),_:1}),t(d,{label:"\u624B\u673A\u53F7"},{default:u(()=>[t(p,{modelValue:e.phone,"onUpdate:modelValue":a[3]||(a[3]=r=>e.phone=r),disabled:!s.value},null,8,["modelValue","disabled"])]),_:1}),s.value?(c(),F(d,{key:0},{default:u(()=>[t(v,{type:"primary",onClick:C},{default:u(()=>a[6]||(a[6]=[k("\u4FDD\u5B58")])),_:1,__:[6]}),t(v,{onClick:B},{default:u(()=>a[7]||(a[7]=[k("\u53D6\u6D88")])),_:1,__:[7]})]),_:1})):(c(),F(d,{key:1},{default:u(()=>[t(v,{type:"primary",onClick:y},{default:u(()=>a[8]||(a[8]=[k("\u7F16\u8F91")])),_:1,__:[8]})]),_:1}))]),_:1},8,["model"])]),_:1})])}}});var Q=x(G,[["__scopeId","data-v-82676f46"]]);export{Q as default};
