import{s as g}from"./request.12a390b5.js";import{_ as se,d as re,y as M,r as d,o as de,b as r,H as ie,e as j,f as ce,g as u,h as l,j as m,i as v,I as pe,m as me,t as fe,J as _e,E as S}from"./index.2cc8de7c.js";function ve(i){return g({url:"/roles",method:"get",params:i})}function ge(i){return g({url:"/roles",method:"post",data:i})}function De(i,c){return g({url:`/roles/${i}`,method:"put",data:c})}function Fe(i){return g({url:`/roles/${i}`,method:"delete"})}function he(i){return g({url:`/roles/${i}/permissions`,method:"get"})}function ye(i,c){return g({url:`/roles/${i}/permissions`,method:"post",data:c})}function Ce(){return g({url:"/permissions/tree",method:"get"})}const be={class:"role-container"},Be={class:"card-header"},ke={class:"pagination"},Ee={class:"dialog-footer"},Ve={class:"permission-dialog-content"},xe={class:"permission-options"},Ae={class:"dialog-footer"},Se=re({__name:"index",setup(i){const c=M({name:"",status:""}),w=d(!1),B=d([]),h=d(1),k=d(10),E=d(0),D=d(!1),V=d("add"),I=d(),n=M({id:"",name:"",code:"",description:"",status:1}),y=d(!1),C=d(),R=d([]),$=d(""),x=d(!0),q={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",trigger:"blur"},{min:2,max:20,message:"\u957F\u5EA6\u5728 2 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"}],code:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801",trigger:"blur"},{min:2,max:20,message:"\u957F\u5EA6\u5728 2 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"}]},F=async()=>{w.value=!0;try{const t=await ve({page:h.value,pageSize:k.value,...c});t.success&&t.data?(B.value=t.data.records||[],E.value=t.data.total||0):(B.value=[],E.value=0)}catch(t){console.error("\u83B7\u53D6\u89D2\u8272\u5217\u8868\u5931\u8D25:",t),B.value=[],E.value=0}finally{w.value=!1}},P=()=>{h.value=1,F()},H=()=>{c.name="",c.status="",P()},L=()=>{V.value="add",n.id="",n.name="",n.code="",n.description="",n.status=1,D.value=!0},J=t=>{V.value="edit",n.id=String(t.id),n.name=t.name,n.code=t.code,n.description=t.description,n.status=t.status,D.value=!0},G=t=>{_e.confirm("\u786E\u8BA4\u5220\u9664\u8BE5\u89D2\u8272\u5417\uFF1F","\u63D0\u793A",{type:"warning"}).then(async()=>{try{await Fe(String(t.id)),S.success("\u5220\u9664\u6210\u529F"),F()}catch(e){console.error("\u5220\u9664\u89D2\u8272\u5931\u8D25:",e)}})},O=async()=>{!I.value||await I.value.validate(async t=>{if(t)try{V.value==="add"?(await ge(n),S.success("\u65B0\u589E\u6210\u529F")):(await De(String(n.id),n),S.success("\u66F4\u65B0\u6210\u529F")),D.value=!1,F()}catch(e){console.error("\u63D0\u4EA4\u5931\u8D25:",e)}})},Q=async t=>{var e;$.value=String(t.id);try{const o=await Ce();o.success&&(R.value=o.data||[]);const s=await he(String(t.id));s.success&&((e=C.value)==null||e.setCheckedKeys(s.data||[])),y.value=!0}catch(o){console.error("\u83B7\u53D6\u6743\u9650\u6570\u636E\u5931\u8D25:",o)}},U=t=>{let e=[];return t.children&&t.children.length>0&&t.children.forEach(o=>{e.push(o.id),e=e.concat(U(o))}),e},N=(t,e)=>{for(const o of t){if(o.id===e)return o;if(o.children&&o.children.length>0){const s=N(o.children,e);if(s)return s}}return null},W=async()=>{var t,e;try{const o=((t=C.value)==null?void 0:t.getCheckedKeys())||[],s=((e=C.value)==null?void 0:e.getHalfCheckedKeys())||[];let _=[...o];if(x.value){const A=new Set;o.forEach(p=>{const b=N(R.value,p);b&&U(b).forEach(f=>A.add(f))}),_=Array.from(new Set([...o,...Array.from(A)]))}await ye($.value,_),S.success("\u6743\u9650\u5206\u914D\u6210\u529F"),y.value=!1}catch(o){console.error("\u6743\u9650\u5206\u914D\u5931\u8D25:",o)}},X=(t,e)=>{x.value&&e.checkedNodes&&e.checkedNodes.length>0&&t.children&&t.children.length>0&&U(t).forEach(s=>{var _;(_=C.value)==null||_.setChecked(s,!0,!1)})},Y=t=>{k.value=t,F()},Z=t=>{h.value=t,F()};return de(()=>{F()}),(t,e)=>{const o=r("el-input"),s=r("el-form-item"),_=r("el-option"),A=r("el-select"),p=r("el-button"),b=r("el-form"),z=r("el-card"),f=r("el-table-column"),ee=r("el-tag"),ue=r("el-table"),te=r("el-pagination"),le=r("el-switch"),T=r("el-dialog"),ae=r("el-checkbox"),oe=r("el-tree"),ne=ie("loading");return j(),ce("div",be,[u(z,{class:"search-card"},{default:l(()=>[u(b,{inline:!0,model:c,class:"search-form"},{default:l(()=>[u(s,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[u(o,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=a=>c.name=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u72B6\u6001"},{default:l(()=>[u(A,{modelValue:c.status,"onUpdate:modelValue":e[1]||(e[1]=a=>c.status=a),placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",clearable:""},{default:l(()=>[u(_,{label:"\u6B63\u5E38",value:1}),u(_,{label:"\u7981\u7528",value:0})]),_:1},8,["modelValue"])]),_:1}),u(s,null,{default:l(()=>[u(p,{type:"primary",onClick:P},{default:l(()=>e[13]||(e[13]=[m("\u641C\u7D22")])),_:1,__:[13]}),u(p,{onClick:H},{default:l(()=>e[14]||(e[14]=[m("\u91CD\u7F6E")])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])]),_:1}),u(z,{class:"table-card"},{header:l(()=>[v("div",Be,[e[16]||(e[16]=v("span",null,"\u89D2\u8272\u5217\u8868",-1)),u(p,{type:"primary",onClick:L},{default:l(()=>e[15]||(e[15]=[m("\u65B0\u589E\u89D2\u8272")])),_:1,__:[15]})])]),default:l(()=>[pe((j(),me(ue,{data:B.value,border:"",style:{width:"100%"}},{default:l(()=>[u(f,{prop:"id",label:"ID",width:"80"}),u(f,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),u(f,{prop:"code",label:"\u89D2\u8272\u7F16\u7801"}),u(f,{prop:"description",label:"\u63CF\u8FF0"}),u(f,{prop:"status",label:"\u72B6\u6001",width:"100"},{default:l(({row:a})=>[u(ee,{type:a.status===1?"success":"danger"},{default:l(()=>[m(fe(a.status===1?"\u6B63\u5E38":"\u7981\u7528"),1)]),_:2},1032,["type"])]),_:1}),u(f,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",width:"180"}),u(f,{label:"\u64CD\u4F5C",width:"280",fixed:"right"},{default:l(({row:a})=>[u(p,{type:"primary",link:"",onClick:K=>J(a)},{default:l(()=>e[17]||(e[17]=[m("\u7F16\u8F91")])),_:2,__:[17]},1032,["onClick"]),u(p,{type:"success",link:"",onClick:K=>Q(a)},{default:l(()=>e[18]||(e[18]=[m("\u5206\u914D\u6743\u9650")])),_:2,__:[18]},1032,["onClick"]),u(p,{type:"danger",link:"",onClick:K=>G(a)},{default:l(()=>e[19]||(e[19]=[m("\u5220\u9664")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),v("div",ke,[u(te,{"current-page":h.value,"onUpdate:currentPage":e[2]||(e[2]=a=>h.value=a),"page-size":k.value,"onUpdate:pageSize":e[3]||(e[3]=a=>k.value=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:E.value,onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1}),u(T,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=a=>D.value=a),title:V.value==="add"?"\u65B0\u589E\u89D2\u8272":"\u7F16\u8F91\u89D2\u8272",width:"500px"},{footer:l(()=>[v("span",Ee,[u(p,{onClick:e[8]||(e[8]=a=>D.value=!1)},{default:l(()=>e[20]||(e[20]=[m("\u53D6\u6D88")])),_:1,__:[20]}),u(p,{type:"primary",onClick:O},{default:l(()=>e[21]||(e[21]=[m("\u786E\u5B9A")])),_:1,__:[21]})])]),default:l(()=>[u(b,{ref_key:"formRef",ref:I,model:n,rules:q,"label-width":"100px"},{default:l(()=>[u(s,{label:"\u89D2\u8272\u540D\u79F0",prop:"name"},{default:l(()=>[u(o,{modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=a=>n.name=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u89D2\u8272\u7F16\u7801",prop:"code"},{default:l(()=>[u(o,{modelValue:n.code,"onUpdate:modelValue":e[5]||(e[5]=a=>n.code=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u7F16\u7801"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u63CF\u8FF0",prop:"description"},{default:l(()=>[u(o,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=a=>n.description=a),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u72B6\u6001",prop:"status"},{default:l(()=>[u(le,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=a=>n.status=a),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(T,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value=a),title:"\u5206\u914D\u6743\u9650",width:"600px"},{default:l(()=>[v("div",Ve,[v("div",xe,[u(ae,{modelValue:x.value,"onUpdate:modelValue":e[10]||(e[10]=a=>x.value=a),label:"\u9009\u4E2D\u4E3B\u83DC\u5355\u65F6\u81EA\u52A8\u9009\u62E9\u5B50\u83DC\u5355"},{default:l(()=>e[22]||(e[22]=[m(" \u9009\u4E2D\u4E3B\u83DC\u5355\u65F6\u81EA\u52A8\u9009\u62E9\u5B50\u83DC\u5355 ")])),_:1,__:[22]},8,["modelValue"])]),u(oe,{ref_key:"permissionTree",ref:C,data:R.value,"show-checkbox":"","node-key":"id",props:{label:"name",children:"children"},onCheck:X},null,8,["data"])])]),footer:l(()=>[v("span",Ae,[u(p,{onClick:e[11]||(e[11]=a=>y.value=!1)},{default:l(()=>e[23]||(e[23]=[m("\u53D6\u6D88")])),_:1,__:[23]}),u(p,{type:"primary",onClick:W},{default:l(()=>e[24]||(e[24]=[m("\u786E\u5B9A")])),_:1,__:[24]})])]),_:1},8,["modelValue"])])}}});var Re=se(Se,[["__scopeId","data-v-348a3171"]]);export{Re as default};
