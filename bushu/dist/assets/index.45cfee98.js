import{_ as ve,d as fe,r as i,y as P,o as Fe,b as m,H as Ce,e as E,f as K,i as v,g as a,h as l,j as c,I as ye,m as $,z as M,L as T,t as q,F as Ee,l as Ve,M as be,E as g,J as Be}from"./index.2cc8de7c.js";import{a as ke,g as De,b as he,e as H,f as Ue}from"./product.4ae09d3b.js";import{u as Ie}from"./upload.a442cc91.js";import"./request.12a390b5.js";const xe={class:"product-container"},Se={class:"header"},we={class:"image-error"},Le={key:1,class:"image-error"},ze={class:"pagination"},Ae=["src"],Pe={class:"dialog-footer"},Ke={class:"sku-header"},$e={class:"dialog-footer"},Me=fe({__name:"index",setup(qe){const S=i(!1),h=i([]),f=i(1),V=i(10),U=i(0),b=i([]),F=i(!1),B=i("add"),w=i(),s=P({id:"",name:"",categoryId:"",description:"",mainImage:"",price:0,status:1,skuList:[],sort:0});i(!1),i(),i(null),P({stock:0});const J={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",trigger:"blur"},{min:2,max:50,message:"\u957F\u5EA6\u5728 2 \u5230 50 \u4E2A\u5B57\u7B26",trigger:"blur"}],categoryId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u5206\u7C7B",trigger:"change"}],mainImage:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u5546\u54C1\u4E3B\u56FE",trigger:"change"}],price:[{required:!0,message:"\u8BF7\u8F93\u5165\u5546\u54C1\u4EF7\u683C",trigger:"blur"},{type:"number",min:0,message:"\u4EF7\u683C\u5FC5\u987B\u5927\u4E8E0",trigger:"blur"}],status:[{required:!0,message:"\u8BF7\u9009\u62E9\u5546\u54C1\u72B6\u6001",trigger:"change"}],description:[{max:500,message:"\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7 500 \u4E2A\u5B57\u7B26",trigger:"blur"}]},C=i([]),I=i(!1),k=P({name:""}),L=i(!1),N=i(""),y=async()=>{var t,e;S.value=!0;try{const n={size:V.value,page:f.value,name:k.name},o=await ke(n);o.success&&o.data?(h.value=o.data.records||[],U.value=o.data.total||0,f.value=o.data.current||1,V.value=o.data.size||10):(h.value=[],U.value=0)}catch(n){g.error(((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"\u83B7\u53D6\u5546\u54C1\u5217\u8868\u5931\u8D25"),h.value=[],U.value=0}finally{S.value=!1}},O=t=>{const e=b.value.find(n=>n.id===t);return e?e.name:"-"},W=async()=>{var t,e;try{const n=await De();n.success&&n.data?b.value=n.data.records||[]:b.value=[]}catch(n){g.error(((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"\u83B7\u53D6\u5206\u7C7B\u5217\u8868\u5931\u8D25"),b.value=[]}},G=()=>{B.value="add",s.id="",s.name="",s.categoryId="",s.description="",s.mainImage="",s.price=0,s.status=1,s.skuList=[],C.value=[],F.value=!0},Q=t=>{B.value="edit",s.id=t.id,s.name=t.name,s.categoryId=t.categoryId,s.description=t.description,s.mainImage=t.mainImage||"",s.price=t.price,s.status=t.status,s.skuList=t.skuList||[],s.sort=t.sort||0,t.mainImage?C.value=[{name:"\u5546\u54C1\u4E3B\u56FE",url:t.mainImage,status:"success"}]:C.value=[],F.value=!0},X=t=>{Be.confirm("\u786E\u8BA4\u5220\u9664\u8BE5\u5546\u54C1\u5417\uFF1F","\u63D0\u793A",{type:"warning"}).then(async()=>{var e,n;try{await he(String(t.id)),g.success("\u5220\u9664\u6210\u529F"),y()}catch(o){g.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"\u5220\u9664\u5546\u54C1\u5931\u8D25")}})},Y=async t=>{var n,o;const e=t.status===1?0:1;t.status=e;try{await H(String(t.id),{...t,status:e}),g.success("\u72B6\u6001\u66F4\u65B0\u6210\u529F")}catch(d){t.status=t.status===1?0:1,g.error(((o=(n=d.response)==null?void 0:n.data)==null?void 0:o.message)||"\u72B6\u6001\u66F4\u65B0\u5931\u8D25")}},Z=t=>{s.skuList=t.skuList||[],I.value=!0},ee=()=>{s.skuList.push({skuCode:"",name:"",attributes:"",price:0,stock:0,status:1})},ue=t=>{s.skuList.splice(t,1)},ae=async()=>{!w.value||await w.value.validate(async t=>{var e,n;if(t)try{const o={...s,mainImage:s.mainImage||""};B.value==="add"?(await Ue(o),g.success("\u65B0\u589E\u6210\u529F")):(await H(String(s.id),o),g.success("\u66F4\u65B0\u6210\u529F")),F.value=!1,y()}catch(o){g.error(((n=(e=o.response)==null?void 0:e.data)==null?void 0:n.message)||"\u63D0\u4EA4\u5931\u8D25")}})},te=t=>{V.value=t,y()},le=t=>{f.value=t,y()},se=async t=>{var o,d,D,r;const e=(o=t.raw)==null?void 0:o.type.startsWith("image/"),n=((d=t.raw)==null?void 0:d.size)&&t.raw.size/1024/1024<10;if(!e)return g.error("\u53EA\u80FD\u4E0A\u4F20\u56FE\u7247\u6587\u4EF6\uFF01"),!1;if(!n)return g.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 10MB\uFF01"),!1;try{t.status="uploading";const _=await Ie(t.raw);_.data?(s.mainImage=_.data,C.value=[{name:t.name,url:_.data,status:"success"}],g.success("\u56FE\u7247\u4E0A\u4F20\u6210\u529F")):(t.status="fail",g.error("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25"))}catch(_){t.status="fail",g.error(((r=(D=_.response)==null?void 0:D.data)==null?void 0:r.message)||"\u56FE\u7247\u4E0A\u4F20\u5931\u8D25")}},oe=t=>{N.value=t.url,L.value=!0},ne=()=>{s.mainImage="",C.value=[],B.value==="edit"&&(s.mainImage="")},R=()=>{f.value=1,y()},re=()=>{k.name="",R()};return Fe(()=>{y(),W()}),(t,e)=>{const n=m("el-input"),o=m("el-form-item"),d=m("el-button"),D=m("el-form"),r=m("el-table-column"),_=m("el-icon"),de=m("el-image"),ie=m("el-tag"),z=m("el-switch"),j=m("el-table"),me=m("el-pagination"),pe=m("el-option"),ce=m("el-select"),x=m("el-input-number"),ge=m("el-upload"),A=m("el-dialog"),_e=Ce("loading");return E(),K("div",xe,[v("div",Se,[a(D,{inline:!0,model:k,class:"search-form"},{default:l(()=>[a(o,{label:"\u5546\u54C1\u540D\u79F0"},{default:l(()=>[a(n,{modelValue:k.name,"onUpdate:modelValue":e[0]||(e[0]=u=>k.name=u),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1}),a(o,null,{default:l(()=>[a(d,{type:"primary",onClick:R},{default:l(()=>e[15]||(e[15]=[c("\u641C\u7D22")])),_:1,__:[15]}),a(d,{onClick:re},{default:l(()=>e[16]||(e[16]=[c("\u91CD\u7F6E")])),_:1,__:[16]}),a(d,{type:"success",onClick:G},{default:l(()=>e[17]||(e[17]=[v("i",{class:"sfont system-add"},null,-1),c("\u65B0\u589E\u5546\u54C1 ")])),_:1,__:[17]})]),_:1})]),_:1},8,["model"])]),ye((E(),$(j,{data:h.value,border:"",style:{width:"100%"}},{default:l(()=>[a(r,{prop:"id",label:"ID",width:"80"}),a(r,{label:"\u5546\u54C1\u56FE\u7247",width:"100"},{default:l(({row:u})=>[u.mainImage?(E(),$(de,{key:0,src:u.mainImage,"preview-src-list":[u.mainImage],fit:"cover",style:{width:"50px",height:"50px","border-radius":"4px"}},{error:l(()=>[v("div",we,[a(_,null,{default:l(()=>[a(M(T))]),_:1})])]),_:2},1032,["src","preview-src-list"])):(E(),K("div",Le,[a(_,null,{default:l(()=>[a(M(T))]),_:1})]))]),_:1}),a(r,{prop:"name",label:"\u5546\u54C1\u540D\u79F0"}),a(r,{prop:"categoryName",label:"\u6240\u5C5E\u5206\u7C7B"},{default:l(({row:u})=>[c(q(O(u.categoryId)),1)]),_:1}),a(r,{prop:"price",label:"\u4EF7\u683C",width:"100"},{default:l(({row:u})=>[c(" \xA5"+q(u.price),1)]),_:1}),a(r,{prop:"stock",label:"\u5E93\u5B58",width:"100"}),a(r,{prop:"status",label:"\u72B6\u6001",width:"100"},{default:l(({row:u})=>[a(ie,{type:u.status===1?"success":"danger",size:"small"},{default:l(()=>[c(q(u.status===1?"\u4E0A\u67B6":"\u4E0B\u67B6"),1)]),_:2},1032,["type"]),a(z,{"model-value":u.status,"active-value":1,"inactive-value":0,onChange:p=>Y(u),style:{"margin-left":"8px"}},null,8,["model-value","onChange"])]),_:1}),a(r,{label:"\u64CD\u4F5C",width:"250",fixed:"right"},{default:l(({row:u})=>[a(d,{type:"primary",link:"",onClick:p=>Q(u)},{default:l(()=>e[18]||(e[18]=[c("\u7F16\u8F91")])),_:2,__:[18]},1032,["onClick"]),a(d,{type:"danger",link:"",onClick:p=>X(u)},{default:l(()=>e[19]||(e[19]=[c("\u5220\u9664")])),_:2,__:[19]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,S.value]]),v("div",ze,[a(me,{"current-page":f.value,"onUpdate:currentPage":e[1]||(e[1]=u=>f.value=u),"page-size":V.value,"onUpdate:pageSize":e[2]||(e[2]=u=>V.value=u),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:te,onCurrentChange:le},null,8,["current-page","page-size","total"])]),a(A,{modelValue:F.value,"onUpdate:modelValue":e[12]||(e[12]=u=>F.value=u),title:B.value==="add"?"\u65B0\u589E\u5546\u54C1":"\u7F16\u8F91\u5546\u54C1",width:"800px"},{footer:l(()=>[v("span",Pe,[a(d,{onClick:e[11]||(e[11]=u=>F.value=!1)},{default:l(()=>e[21]||(e[21]=[c("\u53D6\u6D88")])),_:1,__:[21]}),a(d,{type:"primary",onClick:ae},{default:l(()=>e[22]||(e[22]=[c("\u786E\u5B9A")])),_:1,__:[22]})])]),default:l(()=>[a(D,{ref_key:"formRef",ref:w,model:s,rules:J,"label-width":"100px"},{default:l(()=>[a(o,{label:"\u5546\u54C1\u540D\u79F0",prop:"name"},{default:l(()=>[a(n,{modelValue:s.name,"onUpdate:modelValue":e[3]||(e[3]=u=>s.name=u),placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(o,{label:"\u6240\u5C5E\u5206\u7C7B",prop:"categoryId"},{default:l(()=>[a(ce,{modelValue:s.categoryId,"onUpdate:modelValue":e[4]||(e[4]=u=>s.categoryId=u),placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B"},{default:l(()=>[(E(!0),K(Ee,null,Ve(b.value,u=>(E(),$(pe,{key:u.id,label:u.name,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"\u5546\u54C1\u4EF7\u683C",prop:"price"},{default:l(()=>[a(x,{modelValue:s.price,"onUpdate:modelValue":e[5]||(e[5]=u=>s.price=u),precision:2,step:.1,min:0},null,8,["modelValue"])]),_:1}),a(o,{label:"\u6392\u5E8F\u53F7",prop:"sort"},{default:l(()=>[a(x,{modelValue:s.sort,"onUpdate:modelValue":e[6]||(e[6]=u=>s.sort=u),min:0,precision:0},null,8,["modelValue"])]),_:1}),a(o,{label:"\u5546\u54C1\u72B6\u6001",prop:"status"},{default:l(()=>[a(z,{modelValue:s.status,"onUpdate:modelValue":e[7]||(e[7]=u=>s.status=u),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),a(o,{label:"\u5546\u54C1\u63CF\u8FF0",prop:"description"},{default:l(()=>[a(n,{modelValue:s.description,"onUpdate:modelValue":e[8]||(e[8]=u=>s.description=u),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5546\u54C1\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),a(o,{label:"\u5546\u54C1\u56FE\u7247",prop:"mainImage"},{default:l(()=>[a(ge,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":se,"on-remove":ne,"on-preview":oe,"file-list":C.value,accept:"image/*"},{default:l(()=>[a(_,null,{default:l(()=>[a(M(be))]),_:1})]),_:1},8,["file-list"]),a(A,{modelValue:L.value,"onUpdate:modelValue":e[9]||(e[9]=u=>L.value=u),title:"\u9884\u89C8"},{default:l(()=>[v("img",{src:N.value,alt:"Preview",style:{width:"100%"}},null,8,Ae)]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"SKU\u5217\u8868"},{default:l(()=>[a(d,{type:"primary",onClick:e[10]||(e[10]=u=>Z(s))},{default:l(()=>e[20]||(e[20]=[c("\u67E5\u770BSKU\u5217\u8868")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(A,{modelValue:I.value,"onUpdate:modelValue":e[14]||(e[14]=u=>I.value=u),title:"SKU\u5217\u8868",width:"800px"},{footer:l(()=>[v("span",$e,[a(d,{onClick:e[13]||(e[13]=u=>I.value=!1)},{default:l(()=>e[25]||(e[25]=[c("\u5173\u95ED")])),_:1,__:[25]})])]),default:l(()=>[v("div",Ke,[a(d,{type:"primary",onClick:ee},{default:l(()=>e[23]||(e[23]=[v("i",{class:"sfont system-add"},null,-1),c("\u65B0\u589ESKU ")])),_:1,__:[23]})]),a(j,{data:s.skuList,border:"",style:{width:"100%"}},{default:l(()=>[a(r,{prop:"skuCode",label:"SKU\u7F16\u7801",width:"180"},{default:l(({row:u})=>[a(n,{modelValue:u.skuCode,"onUpdate:modelValue":p=>u.skuCode=p,placeholder:"\u8BF7\u8F93\u5165SKU\u7F16\u7801"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{prop:"name",label:"SKU\u540D\u79F0",width:"180"},{default:l(({row:u})=>[a(n,{modelValue:u.name,"onUpdate:modelValue":p=>u.name=p,placeholder:"\u8BF7\u8F93\u5165SKU\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{prop:"attributes",label:"\u89C4\u683C\u5C5E\u6027",width:"180"},{default:l(({row:u})=>[a(n,{modelValue:u.attributes,"onUpdate:modelValue":p=>u.attributes=p,placeholder:"\u8BF7\u8F93\u5165\u89C4\u683C\u5C5E\u6027"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{prop:"price",label:"\u4EF7\u683C",width:"120"},{default:l(({row:u})=>[a(x,{modelValue:u.price,"onUpdate:modelValue":p=>u.price=p,precision:2,step:.1,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{prop:"stock",label:"\u5E93\u5B58",width:"120"},{default:l(({row:u})=>[a(x,{modelValue:u.stock,"onUpdate:modelValue":p=>u.stock=p,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{prop:"status",label:"\u72B6\u6001",width:"100"},{default:l(({row:u})=>[a(z,{modelValue:u.status,"onUpdate:modelValue":p=>u.status=p,"active-value":1,"inactive-value":0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(r,{label:"\u64CD\u4F5C",width:"100",fixed:"right"},{default:l(({$index:u})=>[a(d,{type:"danger",link:"",onClick:p=>ue(u)},{default:l(()=>e[24]||(e[24]=[c("\u5220\u9664")])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}});var He=ve(Me,[["__scopeId","data-v-4dcbb0dc"]]);export{He as default};
