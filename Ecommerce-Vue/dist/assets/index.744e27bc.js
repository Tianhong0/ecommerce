import{s as b}from"./request.12a390b5.js";import{_ as ne,d as se,y as H,r as m,o as re,b as r,H as de,e as v,f as w,g as u,h as a,j as i,i as E,I as ie,m as R,t as J,F as q,l as N,k as me,J as pe,E as x}from"./index.2cc8de7c.js";function ce(d){return b({url:"/users",method:"get",params:d})}function fe(d){return b({url:"/users",method:"post",data:d})}function ge(d,B){return b({url:`/users/${d}`,method:"put",data:B})}function ve(d){return b({url:`/users/${d}`,method:"delete"})}function Be(d){return b({url:`/users/${d}/roles`,method:"get"})}function _e(d,B){return b({url:`/users/${d}/roles`,method:"post",data:B})}const Fe={class:"users-container"},be={class:"card-header"},Ve={class:"pagination"},De={class:"dialog-footer"},ye={class:"dialog-footer"},Ee=se({__name:"index",setup(d){const B=[{id:1,name:"\u8D85\u7EA7\u7BA1\u7406\u5458"},{id:2,name:"\u666E\u901A\u7528\u6237"}],n=H({username:"",nickname:"",email:"",phone:"",status:void 0}),S=m(!1),k=m([]),V=m(1),A=m(10),C=m(0),_=m(!1),F=m("add"),I=m(),t=H({id:"",username:"",password:"",nickname:"",email:"",phone:"",status:1,roleIds:[]}),D=m(!1),U=m([]),L=m(""),O={username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},{min:3,max:20,message:"\u957F\u5EA6\u5728 3 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{min:6,max:20,message:"\u957F\u5EA6\u5728 6 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"}],nickname:[{required:!0,message:"\u8BF7\u8F93\u5165\u6635\u79F0",trigger:"blur"},{min:2,max:20,message:"\u957F\u5EA6\u5728 2 \u5230 20 \u4E2A\u5B57\u7B26",trigger:"blur"}],email:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1",trigger:"blur"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:"blur"}],phone:[{required:!0,message:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7",trigger:"blur"}],roleIds:[{required:!0,message:"\u8BF7\u9009\u62E9\u89D2\u8272",trigger:"change"}]},g=async()=>{S.value=!0;try{const o=await ce({pageNum:V.value,pageSize:A.value,...n});o.success&&o.data?(k.value=o.data.records||[],C.value=o.data.total||0):(k.value=[],C.value=0)}catch(o){console.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25:",o),k.value=[],C.value=0}finally{S.value=!1}},M=()=>{V.value=1,g()},G=()=>{n.username="",n.nickname="",n.email="",n.phone="",n.status=void 0,M()},K=()=>{F.value="add",t.id="",t.username="",t.password="",t.nickname="",t.email="",t.phone="",t.status=1,t.roleIds=[],_.value=!0},Q=o=>{F.value="edit",t.id=String(o.id),t.username=o.username,t.nickname=o.nickname,t.email=o.email,t.phone=o.phone,t.status=o.status,t.roleIds=o.roleIds,_.value=!0},W=o=>{pe.confirm("\u786E\u8BA4\u5220\u9664\u8BE5\u7528\u6237\u5417\uFF1F","\u63D0\u793A",{type:"warning"}).then(async()=>{try{await ve(String(o.id)),x.success("\u5220\u9664\u6210\u529F"),g()}catch(e){console.error("\u5220\u9664\u7528\u6237\u5931\u8D25:",e)}})},X=async()=>{!I.value||await I.value.validate(async o=>{if(o)try{F.value==="add"?(await fe(t),x.success("\u65B0\u589E\u6210\u529F")):(await ge(String(t.id),t),x.success("\u66F4\u65B0\u6210\u529F")),_.value=!1,g()}catch(e){console.error("\u63D0\u4EA4\u5931\u8D25:",e)}})},Y=async o=>{L.value=String(o.id);try{const e=await Be(String(o.id));e.success&&(U.value=e.data||[]),D.value=!0}catch(e){console.error("\u83B7\u53D6\u7528\u6237\u89D2\u8272\u5931\u8D25:",e)}},Z=async()=>{try{await _e(L.value,U.value),x.success("\u89D2\u8272\u5206\u914D\u6210\u529F"),D.value=!1,g()}catch(o){console.error("\u89D2\u8272\u5206\u914D\u5931\u8D25:",o)}},ee=o=>{A.value=o,g()},ue=o=>{V.value=o,g()};return re(()=>{g()}),(o,e)=>{const c=r("el-input"),s=r("el-form-item"),h=r("el-option"),$=r("el-select"),p=r("el-button"),z=r("el-form"),T=r("el-card"),f=r("el-table-column"),j=r("el-tag"),le=r("el-table"),ae=r("el-pagination"),te=r("el-switch"),P=r("el-dialog"),oe=de("loading");return v(),w("div",Fe,[u(T,{class:"search-card"},{default:a(()=>[u(z,{inline:!0,model:n,class:"search-form"},{default:a(()=>[u(s,{label:"\u7528\u6237\u540D"},{default:a(()=>[u(c,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=l=>n.username=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",clearable:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u6635\u79F0"},{default:a(()=>[u(c,{modelValue:n.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>n.nickname=l),placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0",clearable:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u90AE\u7BB1"},{default:a(()=>[u(c,{modelValue:n.email,"onUpdate:modelValue":e[2]||(e[2]=l=>n.email=l),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",clearable:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u624B\u673A\u53F7"},{default:a(()=>[u(c,{modelValue:n.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>n.phone=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7",clearable:""},null,8,["modelValue"])]),_:1}),u(s,{label:"\u72B6\u6001"},{default:a(()=>[u($,{modelValue:n.status,"onUpdate:modelValue":e[4]||(e[4]=l=>n.status=l),placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",clearable:""},{default:a(()=>[u(h,{label:"\u6B63\u5E38",value:1}),u(h,{label:"\u7981\u7528",value:0})]),_:1},8,["modelValue"])]),_:1}),u(s,null,{default:a(()=>[u(p,{type:"primary",onClick:M},{default:a(()=>e[19]||(e[19]=[i("\u641C\u7D22")])),_:1,__:[19]}),u(p,{onClick:G},{default:a(()=>e[20]||(e[20]=[i("\u91CD\u7F6E")])),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),_:1}),u(T,{class:"table-card"},{header:a(()=>[E("div",be,[e[22]||(e[22]=E("span",null,"\u7528\u6237\u5217\u8868",-1)),u(p,{type:"primary",onClick:K},{default:a(()=>e[21]||(e[21]=[i("\u65B0\u589E\u7528\u6237")])),_:1,__:[21]})])]),default:a(()=>[ie((v(),R(le,{data:k.value,border:"",style:{width:"100%"}},{default:a(()=>[u(f,{prop:"id",label:"ID",width:"80"}),u(f,{prop:"username",label:"\u7528\u6237\u540D"}),u(f,{prop:"nickname",label:"\u6635\u79F0"}),u(f,{prop:"email",label:"\u90AE\u7BB1"}),u(f,{prop:"phone",label:"\u624B\u673A\u53F7"}),u(f,{prop:"status",label:"\u72B6\u6001",width:"100"},{default:a(({row:l})=>[u(j,{type:l.status===1?"success":"danger"},{default:a(()=>[i(J(l.status===1?"\u6B63\u5E38":"\u7981\u7528"),1)]),_:2},1032,["type"])]),_:1}),u(f,{prop:"roleIds",label:"\u89D2\u8272",width:"150"},{default:a(({row:l})=>[(v(!0),w(q,null,N(l.roleIds,y=>(v(),R(j,{key:y,class:"mx-1"},{default:a(()=>[i(J(y===1?"\u8D85\u7EA7\u7BA1\u7406\u5458":"\u666E\u901A\u7528\u6237"),1)]),_:2},1024))),128))]),_:1}),u(f,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",width:"180"}),u(f,{label:"\u64CD\u4F5C",width:"280",fixed:"right"},{default:a(({row:l})=>[u(p,{type:"primary",link:"",onClick:y=>Q(l)},{default:a(()=>e[23]||(e[23]=[i("\u7F16\u8F91")])),_:2,__:[23]},1032,["onClick"]),u(p,{type:"success",link:"",onClick:y=>Y(l)},{default:a(()=>e[24]||(e[24]=[i("\u5206\u914D\u89D2\u8272")])),_:2,__:[24]},1032,["onClick"]),u(p,{type:"danger",link:"",onClick:y=>W(l)},{default:a(()=>e[25]||(e[25]=[i("\u5220\u9664")])),_:2,__:[25]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,S.value]]),E("div",Ve,[u(ae,{"current-page":V.value,"onUpdate:currentPage":e[5]||(e[5]=l=>V.value=l),"page-size":A.value,"onUpdate:pageSize":e[6]||(e[6]=l=>A.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:C.value,onSizeChange:ee,onCurrentChange:ue},null,8,["current-page","page-size","total"])])]),_:1}),u(P,{modelValue:_.value,"onUpdate:modelValue":e[15]||(e[15]=l=>_.value=l),title:F.value==="add"?"\u65B0\u589E\u7528\u6237":"\u7F16\u8F91\u7528\u6237",width:"500px"},{footer:a(()=>[E("span",De,[u(p,{onClick:e[14]||(e[14]=l=>_.value=!1)},{default:a(()=>e[26]||(e[26]=[i("\u53D6\u6D88")])),_:1,__:[26]}),u(p,{type:"primary",onClick:X},{default:a(()=>e[27]||(e[27]=[i("\u786E\u5B9A")])),_:1,__:[27]})])]),default:a(()=>[u(z,{ref_key:"formRef",ref:I,model:t,rules:O,"label-width":"100px"},{default:a(()=>[u(s,{label:"\u7528\u6237\u540D",prop:"username"},{default:a(()=>[u(c,{modelValue:t.username,"onUpdate:modelValue":e[7]||(e[7]=l=>t.username=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",disabled:F.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),F.value==="add"?(v(),R(s,{key:0,label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[u(c,{modelValue:t.password,"onUpdate:modelValue":e[8]||(e[8]=l=>t.password=l),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","show-password":""},null,8,["modelValue"])]),_:1})):me("",!0),u(s,{label:"\u6635\u79F0",prop:"nickname"},{default:a(()=>[u(c,{modelValue:t.nickname,"onUpdate:modelValue":e[9]||(e[9]=l=>t.nickname=l),placeholder:"\u8BF7\u8F93\u5165\u6635\u79F0"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u90AE\u7BB1",prop:"email"},{default:a(()=>[u(c,{modelValue:t.email,"onUpdate:modelValue":e[10]||(e[10]=l=>t.email=l),placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u624B\u673A\u53F7",prop:"phone"},{default:a(()=>[u(c,{modelValue:t.phone,"onUpdate:modelValue":e[11]||(e[11]=l=>t.phone=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),u(s,{label:"\u89D2\u8272",prop:"roleIds"},{default:a(()=>[u($,{modelValue:t.roleIds,"onUpdate:modelValue":e[12]||(e[12]=l=>t.roleIds=l),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272"},{default:a(()=>[(v(),w(q,null,N(B,l=>u(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),u(s,{label:"\u72B6\u6001",prop:"status"},{default:a(()=>[u(te,{modelValue:t.status,"onUpdate:modelValue":e[13]||(e[13]=l=>t.status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(P,{modelValue:D.value,"onUpdate:modelValue":e[18]||(e[18]=l=>D.value=l),title:"\u5206\u914D\u89D2\u8272",width:"500px"},{footer:a(()=>[E("span",ye,[u(p,{onClick:e[17]||(e[17]=l=>D.value=!1)},{default:a(()=>e[28]||(e[28]=[i("\u53D6\u6D88")])),_:1,__:[28]}),u(p,{type:"primary",onClick:Z},{default:a(()=>e[29]||(e[29]=[i("\u786E\u5B9A")])),_:1,__:[29]})])]),default:a(()=>[u(z,null,{default:a(()=>[u(s,{label:"\u89D2\u8272"},{default:a(()=>[u($,{modelValue:U.value,"onUpdate:modelValue":e[16]||(e[16]=l=>U.value=l),multiple:"",placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",style:{width:"100%"}},{default:a(()=>[(v(),w(q,null,N(B,l=>u(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});var Ce=ne(Ee,[["__scopeId","data-v-b13e05b2"]]);export{Ce as default};
